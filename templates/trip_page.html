{% extends 'base.html' %}
{% block title %}{{ trip.trip_name }}{% endblock %}
{% block style %}
<link rel="stylesheet" href="/static/css/add_trip_map.css">
{% endblock %}
{% block content %}
    <h2>{{ trip.trip_name }}</h2>
    <h3>By: {{ user.name }}</h3>
    <br>
    <form id='add-trip-form' enctype="multipart/form-data">
        <input type='hidden' id='trip_id' name='trip_id' value='{{ trip.trip_id}}'><br>
        <input type="file" name="file" id="place-pic-file">
        <label for='placename'>Place Name: </label><br>
        <input id="placename" type='text' name='placename' required><br>
        <label for='placesearch'>Search for Place: </label><br>
        <input id="place-search" name="placesearch" type="text" placeholder="Search Box" required>
        <div id="placemap"></div>
        <label for='tripday'>Day of Visit: </label><br>
        <select id="tripday" name="tripday" required>
            <option disabled selected value> -- Select -- </option>
            {% for day in trip_dates %}
                <option value="{{ day[0]}},{{ day[1] }}">Day {{ day[0]}}: {{ day[1] }}</option>
            {% endfor %}
        </select><br>
        <label for='tripcat'>This is a Place to: </label><br>
        <select id="tripcat" name="tripcat" required>
            <option disabled selected value> -- Select -- </option>
            <option value="eat">Eat</option>
            <option value="sleep">Sleep</option>
            <option value="explore">Explore</option>
            <option value="transport">Voyage</option>
        </select><br>
        <label for='tripnotes'>Notes: </label><br>
        <div>
            <textarea id="tripnotes" name="tripnotes"></textarea>
        </div>
        
        <input id="add-place" type='submit' value='Add Place'>
    </form>

    <br><br>
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="editModalLabel">Edit Place</h4>
          </div>
          <div id='modal-form' class="modal-body">
            <form id='edit-place-form'>
                <input type='hidden' id='edit-place_id' name='edit-place_id'><br>
                <input type='hidden' id='edit-trip_id' name='edit-trip_id' value='{{ trip.trip_id}}'><br>
                <label for='edit-placename'>Place Name: </label><br>
                <input id="edit-placename" type='text' name='edit-placename' required><br>
                <label for='edit-placesearch'>Search for Place: </label><br>
                <input id="edit-place-search" name="edit-placesearch" type="text" placeholder="Search Box" required>
                <div id="edit-placemap"></div>
                <label for='edit-tripday'>Day of Visit: </label><br>
                <select id="edit-tripday" name="edit-tripday" required>
                    <option disabled selected value> -- Select -- </option>
                    {% for day in trip_dates %}
                        <option value="{{ day[0]}},{{ day[1] }}">Day {{ day[0]}}: {{ day[1] }}</option>
                    {% endfor %}
                </select><br>
                <label for='edit-tripcat'>This is a Place to: </label><br>
                <select id="edit-tripcat" name="edit-tripcat" required>
                    <option disabled selected value> -- Select -- </option>
                    <option value="eat">Eat</option>
                    <option value="sleep">Sleep</option>
                    <option value="explore">Explore</option>
                    <option value="transport">Voyage</option>
                </select><br>
                <label for='edit-tripnotes'>Notes: </label><br>
                <div>
                    <textarea id="edit-tripnotes" name="edit-tripnotes"></textarea>
                </div>
            </form>
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" id='delete-place-btn' value="Delete Place">
                Delete Place
            </button>
            <button type="submit" class="btn btn-primary" form="edit-place-form" value="Edit Place" id='edit-place-btn'>
                Edit Place
            </button>
          </div>
          
        </div>
      </div>
    </div>
    <div>
        {% for day in trip_dates %}
            <div id='day-{{ day[0] }}'>
                <h4>Day {{ day[0] }}: {{ day[2] }}</h4>
                {% for place in trip_places %}
                    {% if place.day_num == day[0] %}
                        <div id='place-div-{{ place.place_id }}' class='place-div'>
                            <h5>Day:</h5>
                            <p>Day {{ place.day_num }}: {{ place.date }}</p>
                            <h5>Category:</h5>
                            <p>{{ place.cat_id }}</p>
                            <h5>Place Name:</h5>
                            <p>{{ place.place_name }}</p>
                            <h5>Place Address:</h5>
                            <p>{{ place.place_loc }}</p>
                            <h5>Notes:</h5>
                            <p>{{ place.notes }}</p>
                            <img src='/uploads/{{ place.pic_file }}'>
                            <button type="button" class="btn btn-primary btn-sm edit-btn" data-toggle="modal" data-target="#editModal">
                              Edit Place
                            </button>
                        </div>
                    {% endif %}
                {% endfor %}

            </div>
        {% endfor %}
    </div>

    <button type="button" class="btn btn-primary" id='publish-btn'>
            Make Trip Public
    </button>
    <a class="btn btn-primary" href='/logout'>Logout</a>
    <a class="btn btn-info" href='/{{user.username}}/{{ trip.trip_id}}/mapview'>Go to Map</a>
    <a class="btn btn-info" href='/{{user.username}}/trips'>Back to All Trips</a>
    <button type="button" class="btn btn-danger"  id='delete-trip-btn'>
            Delete Trip
    </button>
    {% endblock %}
{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDv88WJq0QSZ8YNl9SUyZRn4zPc0pk9RE0&
libraries=places&callback=tripPageMaps" async defer></script>
<script src="/static/js/add_place_map.js"></script>
<script src="/static/js/add_new_place.js"></script>
<script src="/static/js/edit_place_form.js"></script>
<script src="/static/js/trip_page.js"></script>
{% endblock %}


